/* ============================================================
   GEODUELER v2 — Free Edition (Leaflet + Wikimedia)
   Dark explorer aesthetic
   ============================================================ */

@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=JetBrains+Mono:wght@400;600&family=Source+Sans+3:wght@300;400;600&display=swap');

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:     #0C111E;
  --bg2:    #131929;
  --card:   #1B2438;
  --ele:    #223050;
  --border: #2D3F5C;
  --gold:   #F59E0B;
  --gold2:  #B45309;
  --green:  #22C55E;
  --red:    #EF4444;
  --blue:   #3B82F6;
  --t1:     #F1F5F9;
  --t2:     #94A3B8;
  --t3:     #4B6280;
  --ff1: 'Playfair Display', serif;
  --ff2: 'JetBrains Mono', monospace;
  --ff3: 'Source Sans 3', sans-serif;
  --r: 10px;
}

html, body { width:100%; height:100%; background:var(--bg); color:var(--t1); font-family:var(--ff3); overflow:hidden; }

/* ── SCREENS ──────────────────────────────────────────── */
.screen { display:none; position:fixed; inset:0; overflow-y:auto; }
.screen.active { display:flex; flex-direction:column; }

/* ── LOADING ──────────────────────────────────────────── */
#loading-overlay {
  display:none; position:fixed; inset:0;
  background:rgba(12,17,30,0.92); z-index:9999;
  align-items:center; justify-content:center; flex-direction:column; gap:16px;
}
#loading-overlay.visible { display:flex; }
.spinner { width:40px; height:40px; border:3px solid var(--border); border-top-color:var(--gold); border-radius:50%; animation:spin .8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }
.loading-text { color:var(--t2); font-family:var(--ff2); font-size:.85rem; }

/* ── TOAST ──────────────────────────────────────────────── */
#toast {
  position:fixed; bottom:24px; left:50%;
  transform:translateX(-50%) translateY(80px);
  background:var(--card); border:1px solid var(--border);
  color:var(--t1); padding:10px 22px; border-radius:999px;
  font-family:var(--ff2); font-size:.85rem;
  transition:transform .3s; z-index:10000;
  box-shadow:0 4px 24px rgba(0,0,0,.5);
}
#toast.visible { transform:translateX(-50%) translateY(0); }

/* ── MENU ──────────────────────────────────────────────── */
#screen-menu {
  align-items:center; justify-content:center; overflow-y:auto;
  background:var(--bg);
  background-image: radial-gradient(ellipse 70% 50% at 50% -5%, rgba(245,158,11,.07) 0%, transparent 70%);
}
.menu-inner { width:100%; max-width:900px; padding:40px 20px; display:flex; flex-direction:column; align-items:center; gap:32px; }
.logo-sub { font-family:var(--ff2); font-size:.7rem; letter-spacing:.3em; color:var(--gold); text-transform:uppercase; margin-bottom:8px; }
.logo-title { font-family:var(--ff1); font-size:clamp(2.4rem,7vw,4.5rem); font-weight:900; color:var(--t1); line-height:1; letter-spacing:-.02em; }
.logo-title span { color:var(--gold); }
.logo-desc { margin-top:12px; color:var(--t2); font-size:1rem; font-weight:300; }
.free-badge { display:inline-flex; align-items:center; gap:6px; margin-top:10px; background:rgba(34,197,94,.1); border:1px solid rgba(34,197,94,.3); color:var(--green); font-family:var(--ff2); font-size:.7rem; letter-spacing:.1em; text-transform:uppercase; padding:4px 12px; border-radius:999px; }

.menu-cards { display:grid; grid-template-columns:1fr 1fr; gap:16px; width:100%; }
.menu-card { background:var(--card); border:1px solid var(--border); border-radius:var(--r); padding:24px; transition:border-color .2s, transform .2s, box-shadow .2s; }
.menu-card:hover { border-color:var(--gold2); transform:translateY(-2px); box-shadow:0 8px 32px rgba(0,0,0,.4); }
.menu-card h3 { font-family:var(--ff1); font-size:1.2rem; color:var(--t1); margin-bottom:6px; }
.menu-card p { font-size:.85rem; color:var(--t2); line-height:1.5; margin-bottom:18px; }

/* ── BUTTONS ──────────────────────────────────────────── */
.btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 20px; border-radius:8px; font-family:var(--ff2); font-size:.82rem; font-weight:600; cursor:pointer; border:none; transition:all .15s; letter-spacing:.05em; }
.btn:disabled { opacity:.4; cursor:not-allowed; }
.btn-primary { background:var(--gold); color:#000; }
.btn-primary:hover:not(:disabled) { background:#FBBF24; transform:translateY(-1px); }
.btn-secondary { background:transparent; color:var(--t1); border:1px solid var(--border); }
.btn-secondary:hover:not(:disabled) { background:var(--ele); border-color:var(--gold2); }
.btn-danger { background:transparent; color:var(--red); border:1px solid rgba(239,68,68,.3); }
.btn-danger:hover { background:rgba(239,68,68,.1); }
.btn-sm { padding:7px 14px; font-size:.76rem; }
.btn-lg { padding:13px 26px; font-size:.92rem; }
.btn-full { width:100%; }

/* ── INPUTS ───────────────────────────────────────────── */
.input-group { display:flex; flex-direction:column; gap:5px; }
.input-label { font-family:var(--ff2); font-size:.68rem; letter-spacing:.1em; text-transform:uppercase; color:var(--t3); }
.input { background:var(--bg2); border:1px solid var(--border); border-radius:8px; color:var(--t1); padding:9px 13px; font-family:var(--ff3); font-size:.9rem; outline:none; transition:border-color .2s; }
.input:focus { border-color:var(--gold2); }
.input::placeholder { color:var(--t3); }
select.input { cursor:pointer; appearance:none; background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%234B6280'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 12px center; padding-right:32px; }
.form-row { display:flex; gap:10px; }
.form-row .input-group { flex:1; }

/* ── LOBBY ────────────────────────────────────────────── */
#screen-lobby { background:var(--bg); align-items:center; justify-content:center; padding:24px 16px; }
.lobby-inner { width:100%; max-width:520px; display:flex; flex-direction:column; gap:18px; }
.lobby-header { display:flex; align-items:center; justify-content:space-between; }
.lobby-header h2 { font-family:var(--ff1); font-size:1.8rem; }
.code-display { display:flex; align-items:center; gap:12px; background:var(--card); border:1px solid var(--border); border-radius:var(--r); padding:16px 20px; }
.code-label { font-family:var(--ff2); font-size:.68rem; letter-spacing:.1em; color:var(--t3); text-transform:uppercase; }
.code-value { font-family:var(--ff2); font-size:2.2rem; font-weight:600; color:var(--gold); letter-spacing:.15em; flex:1; }
.lobby-round-info { font-family:var(--ff2); font-size:.78rem; color:var(--t2); }
.section-label { font-family:var(--ff2); font-size:.68rem; letter-spacing:.12em; text-transform:uppercase; color:var(--t3); }
#lobby-players { display:flex; flex-direction:column; gap:8px; }
.lobby-player { display:flex; align-items:center; gap:12px; background:var(--card); border:1px solid var(--border); border-radius:8px; padding:10px 14px; animation:fadeIn .3s ease; }
.lobby-player.host { border-color:var(--gold2); }
.player-avatar { width:32px; height:32px; background:var(--ele); border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:var(--ff1); font-size:.9rem; color:var(--gold); flex-shrink:0; }
.player-name { flex:1; font-size:.9rem; }
.host-badge { font-family:var(--ff2); font-size:.62rem; background:rgba(245,158,11,.12); color:var(--gold); border:1px solid var(--gold2); border-radius:4px; padding:2px 6px; letter-spacing:.1em; }
#waiting-msg { text-align:center; color:var(--t3); font-family:var(--ff2); font-size:.82rem; padding:8px; }

/* ── GAME SCREEN ──────────────────────────────────────── */
#screen-game { position:fixed; inset:0; overflow:hidden; }

/* Image viewer */
#location-image-container {
  width:100%; flex:1; position:relative; min-height:0;
  background:var(--bg2); overflow:hidden; cursor:zoom-in;
}
#location-image {
  width:100%; height:100%; object-fit:contain;
  transition:opacity .4s ease;
  user-select:none; -webkit-user-drag:none;
  background:#0C111E;
}
#image-loader {
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  background:var(--bg2); flex-direction:column; gap:12px;
}
.image-loader-spinner { width:36px; height:36px; border:3px solid var(--border); border-top-color:var(--gold); border-radius:50%; animation:spin .8s linear infinite; }
#location-hint-bar {
  position:absolute; bottom:0; left:0; right:0;
  background:linear-gradient(to top, rgba(12,17,30,.85) 0%, transparent 100%);
  padding:24px 16px 12px;
  font-family:var(--ff2); font-size:.78rem; color:var(--t2);
  pointer-events:none;
}

/* HUD top */
.game-hud {
  position:absolute; top:0; left:0; right:0;
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 14px;
  background:linear-gradient(to bottom, rgba(12,17,30,.8) 0%, transparent 100%);
  z-index:100; gap:10px; pointer-events:none;
}
.hud-chip {
  display:flex; align-items:center; gap:6px;
  background:rgba(12,17,30,.85); border:1px solid var(--border);
  border-radius:999px; padding:5px 13px;
  backdrop-filter:blur(8px); pointer-events:all;
}
.hud-label { font-family:var(--ff2); font-size:.62rem; letter-spacing:.12em; text-transform:uppercase; color:var(--t3); }
.hud-value { font-family:var(--ff2); font-size:.9rem; font-weight:600; color:var(--t1); }
.timer-display { font-family:var(--ff2); font-size:1.15rem; font-weight:600; color:var(--green); min-width:2ch; text-align:center; }
.timer-display.warning { color:var(--gold); }
.timer-display.urgent { color:var(--red); animation:pulse .5s ease-in-out infinite; }
@keyframes pulse { 50% { opacity:.5; } }

/* Mini map */
#guess-map-container {
  position:fixed; bottom:12px; right:12px;
  width:200px; height:155px;
  border-radius:var(--r); border:2px solid var(--border);
  overflow:hidden; box-shadow:0 4px 24px rgba(0,0,0,.7);
  transition:width .3s, height .3s;
  z-index:500;
}
#guess-map-container.expanded {
  width: min(480px, calc(100vw - 24px));
  height: min(370px, calc(100vh - 90px));
  z-index: 600;
}
#guess-map-canvas { width:100%; height:100%; }
#guess-map-footer {
  position:absolute; bottom:0; left:0; right:0;
  display:flex; gap:6px; padding:8px;
  background:linear-gradient(to top, rgba(12,17,30,.95) 0%, transparent 100%);
}
#map-toggle-btn { position:absolute; top:6px; left:6px; font-size:.68rem; padding:4px 8px; z-index:300; }
#confirm-btn { flex:1; pointer-events:all; }
#guess-count-display {
  position:absolute; top:6px; right:6px;
  font-family:var(--ff2); font-size:.62rem; color:var(--t2);
  background:rgba(12,17,30,.85); border-radius:4px; padding:3px 7px;
}

/* ── ROUND RESULTS ────────────────────────────────────── */
#screen-round-results { background:var(--bg); }
.results-layout {
  display:grid; grid-template-columns:1fr 1fr;
  flex:1; min-height:0;
}
.results-left { display:flex; flex-direction:column; overflow:hidden; }
.results-info { padding:24px 24px 12px; display:flex; flex-direction:column; gap:16px; flex-shrink:0; }
.result-header h2 { font-family:var(--ff1); font-size:1.6rem; margin-bottom:4px; }
.result-location { font-family:var(--ff2); font-size:.78rem; color:var(--gold); letter-spacing:.1em; }
.result-stats { display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; }
.stat-box { background:var(--card); border:1px solid var(--border); border-radius:8px; padding:12px; text-align:center; }
.stat-label { font-family:var(--ff2); font-size:.62rem; letter-spacing:.1em; text-transform:uppercase; color:var(--t3); margin-bottom:4px; }
.stat-value { font-family:var(--ff2); font-size:1.2rem; font-weight:600; color:var(--t1); }
.stat-value.gold { color:var(--gold); }
.stat-value.green { color:var(--green); }

/* Revealed image in results */
.reveal-image-wrap { margin:0 24px; border-radius:var(--r); overflow:hidden; flex-shrink:0; max-height:140px; }
.reveal-image-wrap img { width:100%; height:140px; object-fit:cover; display:block; }

.results-sb { padding:12px 24px 24px; display:flex; flex-direction:column; gap:8px; overflow-y:auto; flex:1; }
#results-map-canvas { width:100%; min-height:400px; }

/* ── SCOREBOARD ───────────────────────────────────────── */
.scoreboard-row { display:flex; align-items:center; gap:10px; padding:9px 13px; background:var(--card); border:1px solid var(--border); border-radius:8px; font-size:.86rem; animation:fadeIn .3s ease; }
.scoreboard-row.me { border-color:var(--gold2); background:rgba(245,158,11,.07); }
.scoreboard-row .rank { font-family:var(--ff2); font-size:.78rem; color:var(--t3); min-width:18px; text-align:center; }
.scoreboard-row .sb-name { flex:1; }
.scoreboard-row .sb-dist { font-family:var(--ff2); font-size:.78rem; color:var(--t2); }
.scoreboard-row .sb-score { font-family:var(--ff2); font-size:.88rem; color:var(--gold); min-width:65px; text-align:right; }

/* ── FINAL ────────────────────────────────────────────── */
#screen-final { background:var(--bg); background-image:radial-gradient(ellipse 60% 40% at 50% 0%, rgba(245,158,11,.07) 0%, transparent 70%); align-items:center; justify-content:center; padding:40px 16px; }
.final-inner { width:100%; max-width:520px; display:flex; flex-direction:column; gap:22px; align-items:center; }
.final-trophy { font-size:3.5rem; animation:bounceIn .6s cubic-bezier(.34,1.56,.64,1); }
@keyframes bounceIn { from{transform:scale(0)} to{transform:scale(1)} }
.final-title { font-family:var(--ff1); font-size:2rem; text-align:center; }
.final-score-num { font-family:var(--ff2); font-size:3.8rem; font-weight:600; color:var(--gold); line-height:1; text-align:center; }
.final-score-label { font-family:var(--ff2); font-size:.72rem; letter-spacing:.15em; color:var(--t3); text-transform:uppercase; margin-top:4px; text-align:center; }
.final-rank-badge { font-family:var(--ff2); font-size:.88rem; color:var(--t2); text-align:center; }
.final-sb-section { width:100%; display:flex; flex-direction:column; gap:7px; }
.rank.rank-1{color:#F59E0B} .rank.rank-2{color:#94A3B8} .rank.rank-3{color:#CD7C3E} .rank.rank-other{color:var(--t3)}

/* ── LEADERBOARD ──────────────────────────────────────── */
#screen-leaderboard { background:var(--bg); align-items:center; padding:32px 16px; }
.lb-inner { width:100%; max-width:600px; display:flex; flex-direction:column; gap:18px; }
.lb-header { display:flex; align-items:center; justify-content:space-between; }
.lb-header h2 { font-family:var(--ff1); font-size:1.9rem; }
#leaderboard-list { display:flex; flex-direction:column; gap:6px; }
.lb-row { display:flex; align-items:center; gap:10px; padding:11px 15px; background:var(--card); border:1px solid var(--border); border-radius:8px; font-size:.88rem; animation:fadeIn .3s ease; }
.lb-row.gold { border-color:rgba(245,158,11,.5); background:rgba(245,158,11,.06); }
.lb-row.silver { border-color:rgba(148,163,184,.35); }
.lb-row.bronze { border-color:rgba(205,124,62,.35); }
.lb-rank { font-family:var(--ff2); font-size:.82rem; color:var(--t3); min-width:22px; text-align:center; }
.lb-name { flex:1; font-weight:600; }
.lb-rounds { font-family:var(--ff2); font-size:.72rem; color:var(--t3); }
.lb-score { font-family:var(--ff2); font-size:.95rem; font-weight:600; color:var(--gold); min-width:70px; text-align:right; }
.loading-row { text-align:center; color:var(--t3); font-family:var(--ff2); font-size:.85rem; padding:24px; }

/* ── DIVIDER ──────────────────────────────────────────── */
.divider { display:flex; align-items:center; gap:12px; color:var(--t3); font-family:var(--ff2); font-size:.68rem; letter-spacing:.1em; text-transform:uppercase; width:100%; }
.divider::before,.divider::after { content:""; flex:1; height:1px; background:var(--border); }

/* ── LEAFLET OVERRIDES ────────────────────────────────── */
.leaflet-container { background:#0C111E; font-family:var(--ff3); }
.leaflet-control-zoom { border:1px solid var(--border) !important; }
.leaflet-control-zoom a { background:var(--card) !important; color:var(--t1) !important; border-bottom:1px solid var(--border) !important; }
.leaflet-control-zoom a:hover { background:var(--ele) !important; }

/* ── ANIMATIONS ───────────────────────────────────────── */
@keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none} }

/* ── RESPONSIVE ───────────────────────────────────────── */
@media(max-width:768px){
  .menu-cards { grid-template-columns:1fr; }
  .results-layout { grid-template-columns:1fr; }
  #results-map-canvas { min-height:250px; }
  .results-info { padding:14px 14px 8px; }
  .results-sb { padding:8px 14px 14px; }
  .reveal-image-wrap { margin:0 14px; }
  .result-stats { grid-template-columns:1fr 1fr; }
  #guess-map-container { width:170px; height:130px; }
  #guess-map-container.expanded { width:calc(100vw - 24px); height:min(300px, 60vh); }
}
